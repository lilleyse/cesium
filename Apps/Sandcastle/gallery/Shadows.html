<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="description" content="Shadow maps.">
    <meta name="cesium-sandcastle-labels" content="Showcases">
    <title>Cesium Demo</title>
    <script type="text/javascript" src="../Sandcastle-header.js"></script>
    <script type="text/javascript" src="../../../ThirdParty/requirejs-2.1.20/require.js"></script>
    <script type="text/javascript">
    require.config({
        baseUrl : '../../../Source',
        waitSeconds : 60
    });
    </script>
</head>
<body class="sandcastle-loading" data-sandcastle-bucket="bucket-requirejs.html">
<style>
    @import url(../templates/bucket.css);
</style>
<div id="cesiumContainer" class="fullSize"></div>
<div id="loadingOverlay"><h1>Loading...</h1></div>
<div id="toolbar"></div>
<script id="cesium_sandcastle_script">
function startup(Cesium) {
    'use strict';
//Sandcastle_Begin

var viewer = new Cesium.Viewer('cesiumContainer', {
    infoBox : false,
    selectionIndicator : false,
    shadows : true,
    terrainShadows : true
});

viewer.terrainProvider = new Cesium.CesiumTerrainProvider({
    url : '//assets.agi.com/stk-terrain/world',
    requestWaterMask : true,
    requestVertexNormals : true
});

var scene = viewer.scene;
var shadowMap = viewer.shadowMap;
var globe = scene.globe;

shadowMap.maxmimumDistance = 10000.0;
globe.depthTestAgainstTerrain = true;

var cesiumAir = viewer.entities.add({
    name : 'Cesium Air',
    height : 20.0,
    model : {
        uri : '../../SampleData/models/CesiumAir/Cesium_Air.glb'
    }
});

var groundVehicle = viewer.entities.add({
    name : 'Ground Vehicle',
    height : 0.0,
    model : {
        uri : '../../SampleData/models/CesiumGround/Cesium_Ground.glb'
    }
});

var cesiumMan = viewer.entities.add({
    name : 'Cesium Man',
    height : 0.0,
    model : {
        uri : '../../SampleData/models/CesiumMan/Cesium_Man.glb'
    }
});

var woodTower = viewer.entities.add({
    name : 'Wood Tower',
    height : 0.0,
    model : {
        uri : '../../SampleData/models/WoodTower/Wood_Tower.gltf'
    }
});

var simpleCity = viewer.entities.add({
    name : 'Simple City',
    height : 0.0,
    model : {
        uri : '../../SampleData/models/ShadowTester/Shadow_Tester_4.gltf'
    }
});

var boxEntity = viewer.entities.add({
    name : 'Red box',
    height : 10.0,
    box : {
        dimensions : new Cesium.Cartesian3(10.0, 10.0, 10.0),
        material : Cesium.Color.RED,
        castShadows : true,
        receiveShadows : true
    }
});

var circleEntity = viewer.entities.add({
    name : 'Green Translucent Circle',
    height : 10.0,
    ellipse : {
        semiMinorAxis : 5.0,
        semiMajorAxis : 5.0,
        material : Cesium.Color.GREEN.withAlpha(0.5),
        outline : true,
        outlineColor : Cesium.Color.GREEN,
        castShadows : true,
        receiveShadows : true
    }
});

var sphereEntity = viewer.entities.add({
    name : 'Blue Sphere Outline',
    height : 5.0,
    ellipsoid : {
        radii : new Cesium.Cartesian3(5.0, 5.0, 5.0),
        outline : true,
        fill : false,
        outlineColor : Cesium.Color.BLUE,
        slicePartitions : 24,
        stackPartitions : 36,
        castShadows : true,
        receiveShadows : true
    }
});

function setShadows(castShadows, receiveShadows) {
    cesiumAir.model.castShadows = castShadows;
    cesiumAir.model.receiveShadows = receiveShadows;
    groundVehicle.model.castShadows = castShadows;
    groundVehicle.model.receiveShadows = receiveShadows;
    cesiumMan.model.castShadows = castShadows;
    cesiumMan.model.receiveShadows = receiveShadows;
    woodTower.model.castShadows = castShadows;
    woodTower.model.receiveShadows = receiveShadows;
    simpleCity.model.castShadows = castShadows;
    simpleCity.model.receiveShadows = receiveShadows;
    boxEntity.box.castShadows = castShadows;
    boxEntity.box.receiveShadows = receiveShadows;
    circleEntity.ellipse.castShadows = castShadows;
    circleEntity.ellipse.receiveShadows = receiveShadows;
    sphereEntity.ellipsoid.castShadows = castShadows;
    sphereEntity.ellipsoid.receiveShadows = receiveShadows;
}

var locations = {
    'Exton' : {
        longitude : -1.31968,
        latitude : 0.698874,
        height : 74.14210186070714,
        date : 2457522.154792
    },
    'Half Dome' : {
        longitude : -2.086267733294987,
        latitude : 0.6587491773830219,
        height : 2636.716312584986,
        date : 2457507.247512
    },
    'Everest' : {
        longitude : 1.517132688,
        latitude : 0.4884844964,
        height : 8773.17824498951,
        date : 2457507.620845
    },
    'Pinnacle PA' : {
        longitude : -1.3324415110874286,
        latitude : 0.6954224325279967,
        height : 179.14276256241743,
        date : 2457523.041620
    },
    'Seneca Rocks' : {
        longitude : -1.3851775172879768,
        latitude : 0.6778211831093554,
        height : 682.5893300695776,
        date : 2457522.097512
    },
    'Space' : {
        longitude : -1.31968,
        latitude : 0.698874,
        height : 2000000.0,
        date : 2457522.154792
    }
};

var i;
var entities = viewer.entities.values;
var entitiesLength = entities.length;

function setLocation(location) {
    for (i = 0; i < entitiesLength; ++i) {
        var entity = entities[i];
        entity.position = Cesium.Cartesian3.fromRadians(location.longitude, location.latitude, location.height + entity.height);
    }

    viewer.clock.currentTime = new Cesium.JulianDate(location.date);
    viewer.clock.multiplier = 1.0;
}

function setLocationFunction(location) {
    return function() {
        setLocation(location);
    };
}

var locationToolbarOptions = [];
for (var locationName in locations) {
    if (locations.hasOwnProperty(locationName)) {
        var location = locations[locationName];
        locationToolbarOptions.push({
            text : locationName,
            onselect : setLocationFunction(location)
        });
    }
}

Sandcastle.addToolbarMenu(locationToolbarOptions);

function setEntity(entity) {
    for (i = 0; i < entitiesLength; ++i) {
        entities[i].show = false;
    }
    entity.show = true;
    viewer.trackedEntity = entity;
}

function setEntityFunction(entity) {
    return function() {
        setEntity(entity);
    };
}

var entityToolbarOptions = [];
for (i = 0; i < entitiesLength; ++i) {
    var entity = entities[i];
    entityToolbarOptions.push({
        text : entity.name,
        onselect : setEntityFunction(entity)
    });
}

Sandcastle.addToolbarMenu(entityToolbarOptions);

Sandcastle.addToolbarButton('Toggle Shadows', function() {
    viewer.shadows = !viewer.shadows;
});

Sandcastle.addToolbarButton('Soft Shadows', function() {
    shadowMap.softShadows = !shadowMap.softShadows;
});

Sandcastle.addToolbarMenu([{
    text : 'Size : 2048',
    onselect : function() {
        shadowMap.size = 2048
    }
}, {
    text : 'Size : 1024',
    onselect : function() {
        shadowMap.size = 1024
    }
}, {
    text : 'Size : 512',
    onselect : function() {
        shadowMap.size = 512
    }
}, {
    text : 'Size : 256',
    onselect : function() {
        shadowMap.size = 256
    }
}]);

Sandcastle.addToolbarMenu([{
    text : 'Entity Shadows',
    onselect : function() {
        setShadows(true, true);
    }
}, {
    text : 'Cast Only',
    onselect : function() {
        setShadows(true, false);
    }
}, {
    text : 'Receive Only',
    onselect : function() {
        setShadows(false, true);
    }
}, {
    text : 'Off',
    onselect : function() {
        setShadows(false, false);
    }
}]);

Sandcastle.addToolbarMenu([{
    text : 'Terrain Shadows',
    onselect : function() {
        globe.castShadows = true;
        globe.receiveShadows = true;
    }
}, {
    text : 'Cast Only',
    onselect : function() {
        globe.castShadows = true;
        globe.receiveShadows = false;
    }
}, {
    text : 'Receive Only',
    onselect : function() {
        globe.castShadows = false;
        globe.receiveShadows = true;
    }
}, {
    text : 'Off',
    onselect : function() {
        globe.castShadows = false;
        globe.receiveShadows = false;
    }
}]);

setLocation(locations['Exton']);
setEntity(cesiumAir);

//Sandcastle_End
Sandcastle.finishedLoading();
}
if (typeof Cesium !== "undefined") {
    startup(Cesium);
} else if (typeof require === "function") {
    require(["Cesium"], startup);
}
</script>
</body>
</html>
